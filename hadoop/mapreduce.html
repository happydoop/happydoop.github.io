<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>MapReduce | Hadoop</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="Hadoop 学习笔记">
    
    <link rel="preload" href="/assets/css/0.styles.bea26999.css" as="style"><link rel="preload" href="/assets/js/app.7696aff8.js" as="script"><link rel="preload" href="/assets/js/2.3c301967.js" as="script"><link rel="preload" href="/assets/js/19.3f563a7b.js" as="script"><link rel="prefetch" href="/assets/js/10.239320ff.js"><link rel="prefetch" href="/assets/js/11.7aea8a94.js"><link rel="prefetch" href="/assets/js/12.a75c9a92.js"><link rel="prefetch" href="/assets/js/13.17c333e6.js"><link rel="prefetch" href="/assets/js/14.c658bd9d.js"><link rel="prefetch" href="/assets/js/15.adf41b6f.js"><link rel="prefetch" href="/assets/js/16.d09250f7.js"><link rel="prefetch" href="/assets/js/17.3a4cbbc8.js"><link rel="prefetch" href="/assets/js/18.a7d27d96.js"><link rel="prefetch" href="/assets/js/20.cf7aaa65.js"><link rel="prefetch" href="/assets/js/21.dabe57d5.js"><link rel="prefetch" href="/assets/js/22.8c1d8730.js"><link rel="prefetch" href="/assets/js/23.b9917a11.js"><link rel="prefetch" href="/assets/js/24.095af618.js"><link rel="prefetch" href="/assets/js/25.d294f37a.js"><link rel="prefetch" href="/assets/js/26.fc764424.js"><link rel="prefetch" href="/assets/js/27.998a5d50.js"><link rel="prefetch" href="/assets/js/28.7d6e20a5.js"><link rel="prefetch" href="/assets/js/29.d2921661.js"><link rel="prefetch" href="/assets/js/3.566e47d9.js"><link rel="prefetch" href="/assets/js/4.23282b51.js"><link rel="prefetch" href="/assets/js/5.c842d990.js"><link rel="prefetch" href="/assets/js/6.ef414eb3.js"><link rel="prefetch" href="/assets/js/7.3152689a.js"><link rel="prefetch" href="/assets/js/8.530be27e.js"><link rel="prefetch" href="/assets/js/9.a4f965b7.js">
    <link rel="stylesheet" href="/assets/css/0.styles.bea26999.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Hadoop</span></a> <div class="links"><!----> <nav class="nav-links can-hide"><div class="nav-item"><a href="/hadoop/install.html" class="nav-link">
  Hadoop
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/hadoop/install.html" class="nav-link">
  Hadoop
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>基础</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/hadoop/install.html" class="sidebar-link">安装</a></li><li><a href="/hadoop/benchmark.html" class="sidebar-link">集群配置与管理</a></li><li><a href="/hadoop/hdfs.html" class="sidebar-link">HDFS</a></li><li><a href="/hadoop/io.html" class="sidebar-link">Hadoop I/O</a></li><li><a href="/hadoop/mapreduce.html" aria-current="page" class="active sidebar-link">MapReduce</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/hadoop/mapreduce.html#mapreduce概述" class="sidebar-link">MapReduce概述</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/hadoop/mapreduce.html#定义" class="sidebar-link">定义</a></li><li class="sidebar-sub-header"><a href="/hadoop/mapreduce.html#mapreduce优缺点" class="sidebar-link">MapReduce优缺点</a></li><li class="sidebar-sub-header"><a href="/hadoop/mapreduce.html#mapreduce核心思想" class="sidebar-link">MapReduce核心思想</a></li><li class="sidebar-sub-header"><a href="/hadoop/mapreduce.html#官方wordcount源码" class="sidebar-link">官方WordCount源码</a></li><li class="sidebar-sub-header"><a href="/hadoop/mapreduce.html#常用数据序列化类型" class="sidebar-link">常用数据序列化类型</a></li></ul></li><li class="sidebar-sub-header"><a href="/hadoop/mapreduce.html#mapreduce编程规范" class="sidebar-link">MapReduce编程规范</a></li><li class="sidebar-sub-header"><a href="/hadoop/mapreduce.html#wordcount案例实操" class="sidebar-link">WordCount案例实操</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/hadoop/mapreduce.html#_1-需求" class="sidebar-link">1.需求</a></li><li class="sidebar-sub-header"><a href="/hadoop/mapreduce.html#_2-需求分析" class="sidebar-link">2.需求分析</a></li><li class="sidebar-sub-header"><a href="/hadoop/mapreduce.html#_3-环境准备" class="sidebar-link">3.环境准备</a></li><li class="sidebar-sub-header"><a href="/hadoop/mapreduce.html#_4-编写程序" class="sidebar-link">4.编写程序</a></li><li class="sidebar-sub-header"><a href="/hadoop/mapreduce.html#_5-编写应用程序" class="sidebar-link">5.编写应用程序</a></li><li class="sidebar-sub-header"><a href="/hadoop/mapreduce.html#在群集上运行" class="sidebar-link">在群集上运行</a></li><li class="sidebar-sub-header"><a href="/hadoop/mapreduce.html#the-mapreduce-web-ui" class="sidebar-link">The MapReduce Web UI</a></li><li class="sidebar-sub-header"><a href="/hadoop/mapreduce.html#检索结果" class="sidebar-link">检索结果</a></li></ul></li></ul></li><li><a href="/hadoop/mysql.html" class="sidebar-link">MySQL</a></li><li><a href="/hadoop/sqoop.html" class="sidebar-link">Sqoop</a></li><li><a href="/hadoop/hive.html" class="sidebar-link">Hive</a></li><li><a href="/hadoop/hbase.html" class="sidebar-link">HBase</a></li><li><a href="/hadoop/pig.html" class="sidebar-link">Pig</a></li><li><a href="/hadoop/spark.html" class="sidebar-link">Spark</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="mapreduce"><a href="#mapreduce" class="header-anchor">¶</a> MapReduce</h1> <h2 id="mapreduce概述"><a href="#mapreduce概述" class="header-anchor">¶</a> MapReduce概述</h2> <h3 id="定义"><a href="#定义" class="header-anchor">¶</a> 定义</h3> <p>MapReduce是一个分布式运算程序的编程框架，是用户开发&quot;基于Hadoop的数据分析应用&quot;的核心框架。</p> <p>MapReduce核心功能是将用户编写的业务逻辑代码和自带默认组件整合成一个完整的分布式运算程序，并发运行在一个hadoop集群上。</p> <h3 id="mapreduce优缺点"><a href="#mapreduce优缺点" class="header-anchor">¶</a> MapReduce优缺点</h3> <p>优点</p> <ol><li>MapReduce易于编程。它简单的实现一些接口，就可以完成一个分布式程序，这个分布式程序可以分布到大量廉价的PC机器上运行。也就是说你写一个分布式程序，跟写一个简单的串行程序是一模一样的。就是因为这个特点使得MapReduce编程变得非常流行。</li> <li>良好的扩展性。当你的计算资源不能得到满足的时候，你可以通过简单地增加机器来扩展它的计算能力。</li> <li>高容错性。MapReduce设计的初衷就是使程序能够部署在廉价的PC机器上，这就要求它具有很高的容错性。比如其中一台机器挂掉了，它可以把上面的计算任务转移到另外一个节点上运行，不至于这个任务运行失败，而且这个过程不需要人工参与，而完全是由Hadoop内部完成的。</li> <li>适合PB级以上海量数据的离线处理。可以实现上千台服务器集群并发工作，提供数据处理能力。</li></ol> <p>缺点</p> <ol><li>不擅长实时计算。MapReduce无法像MySQL一样，在毫秒或者秒级内返回结果。</li> <li>不擅长流式计算。流式计算的输入数据是动态的，而MapReduce的输入数据集是静态的，不能动态变化。这是因为MapReduce自身的设计特点决定了数据源必须是静态的。</li> <li>不擅长DAG（有向图）计算。多个应用程序存在依赖关系，后一个应用程序的输入为前一个的输出。在这种情况下，MapReduce并不是不能做，而是使用后，每个MapReduce作业的输出结果都会写入到磁盘，会造成大量的磁盘IO,导致性能非常的低下。</li></ol> <h3 id="mapreduce核心思想"><a href="#mapreduce核心思想" class="header-anchor">¶</a> MapReduce核心思想</h3> <p>MapReduce核心编程思想，如图所示。</p> <p><img src="/images/hadoop/MapReduce.png" alt="MapReduce 核心编程思想"></p> <p>(1）分布式的运算程序往往需要分成至少2个阶段。</p> <p>(2）第一个阶段的MapTask并发实例，完全并行运行，互不相干。</p> <p>(3）第二个阶段的ReduceTask并发实例互不相干，但是他们的数据依赖于上一个阶段的所有MapTask并发实例的输出。</p> <p>(4）MapReduce编程模型只能包含一个Map阶段和一个Reduce阶段，如果用户的业务逻辑非常复杂，那就只能多个MapReduce程序，串行运行。</p> <p>总结：分析WordCount数据流走向深入理解MapReduce核心思想。</p> <h4 id="mapreduce进程"><a href="#mapreduce进程" class="header-anchor">¶</a> MapReduce进程</h4> <p>一个完整的MapReduce程序在分布式运行时有三类实例进程：</p> <p>(1)MrAppMaster:负责整个程序的过程调度及状态协调。</p> <p>(2)MapTask:负责Map阶段的整个数据处理流程。</p> <p>(3)ReduceTask:负责Reduce阶段的整个数据处理流程。</p> <h3 id="官方wordcount源码"><a href="#官方wordcount源码" class="header-anchor">¶</a> 官方WordCount源码</h3> <p>采用反编译工具反编译源码，发现WordCount案例有Map类、Reduce类和驱动类。且数据的类型是Hadoop自身封装的序列化类型。</p> <h3 id="常用数据序列化类型"><a href="#常用数据序列化类型" class="header-anchor">¶</a> 常用数据序列化类型</h3> <p>表 常用的数据类型对应的Hadoop数据序列化类型</p> <table><thead><tr><th>Java类型</th> <th>Hadoop Writable类型</th></tr></thead> <tbody><tr><td>boolean</td> <td>BooleanWritable</td></tr> <tr><td>byte</td> <td>ByteWritable</td></tr> <tr><td>int</td> <td>IntWritable</td></tr> <tr><td>float</td> <td>FloatWritable</td></tr> <tr><td>long</td> <td>LongWritable</td></tr> <tr><td>double</td> <td>DoubleWritable</td></tr> <tr><td>String</td> <td>Text</td></tr> <tr><td>map</td> <td>MapWritable</td></tr> <tr><td>array</td> <td>ArrayWritable</td></tr></tbody></table> <h2 id="mapreduce编程规范"><a href="#mapreduce编程规范" class="header-anchor">¶</a> MapReduce编程规范</h2> <p>用户编写的程序分成三个部分：Mapper、Reducer和Driver。</p> <p>1、Mapper阶段</p> <p>（1）用户自定义的Mapper要继承自己的父类</p> <p>（2）Mapper的输入数据是KV对的形式（KV的类型可自定义）</p> <p>（3）Mapper中的业务逻辑写在map()方法中</p> <p>（4）Mapper的输出数据是KV对的形式（KV的类型可自定义）</p> <p>（5）map()方法（MapTask进程）对每一个&lt;K,V&gt;调用一次</p> <p>2、Reduce阶段</p> <p>（1）用户自定义的Reducer要继承自己的父类</p> <p>（2）Reducer的输入数据类型对应的Mapper的输出数据类型，也是KV</p> <p>（3）Reducer的业务逻辑写在reduce()方法中</p> <p>（4）ReduceTask进程对每一组相同k的&lt;k,v&gt;组调用一次reduce()方法</p> <p>3、Driver阶段</p> <p>相当于YARN集群的客户端，用于提交我们整个程序到YARN集群，提交的是封装了MapReduce程序相关运行参数的job对象</p> <h2 id="wordcount案例实操"><a href="#wordcount案例实操" class="header-anchor">¶</a> WordCount案例实操</h2> <h3 id="_1-需求"><a href="#_1-需求" class="header-anchor">¶</a> 1.需求</h3> <p>在给定的文本文件中统计输出每一个单词出现的总次数</p> <p>（1）输入数据</p> <p>hello.txt</p> <p>（2）期望输出数据</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>xiaoming	xiaoming
lilei	lilei
hanmeimei	hanmeimei
jiao
banzhang
xue
hadoop
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="_2-需求分析"><a href="#_2-需求分析" class="header-anchor">¶</a> 2.需求分析</h3> <p>按照MapReduce编程规范，分别编写Mapper，Reducer，Driver;</p> <p>（1）输入数据</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>xiaoming	xiaoming
lilei	lilei
hanmeimei	hanmeimei
jiao
banzhang
xue
hadoop
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>（2）Mapper</p> <p>a、将MapTask传给我们的文本内容先转换成String</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>xiaoming    xiaoming
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>b、根据空格将这一行切分成单词</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>xiaoming
xiaoming
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>c、将单词输出为&lt;单词，1&gt;</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>xiaoming，1
xiaoming，1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>（3）Reducer</p> <p>a、汇总各个key的个数</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>xiaoming，1
xiaoming，1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>b、输出该key的总次数</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>xiaoming，2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>（4）Driver</p> <p>a、获取配置信息，获取job对象实例</p> <p>b、指定本程序的jar包所在的本地路劲</p> <p>c、关联Mapper、Reducer业务类</p> <p>d、指定Mapper输出数据的kv类型</p> <p>e、指定最终输出的数据的kv类型</p> <p>f、指定job的输入原始文件所在目录</p> <p>g、指定job的输出结果所在目录</p> <p>h、提交作业</p> <p>（5）输出数据</p> <h3 id="_3-环境准备"><a href="#_3-环境准备" class="header-anchor">¶</a> 3.环境准备</h3> <p>（1）创建maven工程</p> <p><img src="/images/hadoop/MapReduce-create-maven0.png" alt="创建 maven"> <img src="/images/hadoop/MapReduce-creat-maven1.png" alt="创建 maven"></p> <p>(2)在项目的src/main/resources目录下，新建一个文件，命名为“log4j.properties”</p> <p>文件中填入</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>log4j.rootLogger<span class="token operator">=</span>INFO, stdout
log4j.appender.stdout<span class="token operator">=</span>org.apache.log4j.ConsoleAppender
log4j.appender.stdout.layout<span class="token operator">=</span>org.apache.log4j.PatternLayout
log4j.appender.stdout.layout.ConversionPattern<span class="token operator">=</span>%d %p <span class="token punctuation">[</span>%c<span class="token punctuation">]</span> - %m%n
log4j.appender.logfile<span class="token operator">=</span>org.apache.log4j.FileAppender
log4j.appender.logfile.File<span class="token operator">=</span>target/spring.log
log4j.appender.logfile.layout<span class="token operator">=</span>org.apache.log4j.PatternLayout
log4j.appender.logfile.layout.ConversionPattern<span class="token operator">=</span>%d %p <span class="token punctuation">[</span>%c<span class="token punctuation">]</span> - %m%n
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><img src="/images/hadoop/MapReduce-log4j.properties.png" alt="文件 log4j"></p> <h3 id="_4-编写程序"><a href="#_4-编写程序" class="header-anchor">¶</a> 4.编写程序</h3> <h4 id="_1-编写mapper类"><a href="#_1-编写mapper类" class="header-anchor">¶</a> （1）编写Mapper类</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>package com.test.hadoop<span class="token punctuation">;</span>
<span class="token function">import</span> java.io.IOException<span class="token punctuation">;</span>
<span class="token function">import</span> org.apache.hadoop.io.IntWritable<span class="token punctuation">;</span>
<span class="token function">import</span> org.apache.hadoop.io.LongWritable<span class="token punctuation">;</span>
<span class="token function">import</span> org.apache.hadoop.io.Text<span class="token punctuation">;</span>
<span class="token function">import</span> org.apache.hadoop.mapreduce.Mapper<span class="token punctuation">;</span>

    public class WordcountMapper extends Mapper<span class="token operator">&lt;</span>LongWritable, Text, Text, IntWritable<span class="token operator">&gt;</span><span class="token punctuation">{</span>

        Text k <span class="token operator">=</span> new Text<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        IntWritable <span class="token function">v</span> <span class="token operator">=</span> new IntWritable<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        @Override
        protected void map<span class="token punctuation">(</span>LongWritable key, Text value, Context context<span class="token punctuation">)</span>	throws IOException, InterruptedException <span class="token punctuation">{</span>

            // <span class="token number">1</span> 获取一行
            String line <span class="token operator">=</span> value.toString<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            // <span class="token number">2</span> 切割
            String<span class="token punctuation">[</span><span class="token punctuation">]</span> words <span class="token operator">=</span> line.split<span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            // <span class="token number">3</span> 输出
            <span class="token keyword">for</span> <span class="token punctuation">(</span>String word <span class="token builtin class-name">:</span> words<span class="token punctuation">)</span> <span class="token punctuation">{</span>

                k.set<span class="token punctuation">(</span>word<span class="token punctuation">)</span><span class="token punctuation">;</span>
                context.write<span class="token punctuation">(</span>k, <span class="token function">v</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><h4 id="_2-编写reducer类"><a href="#_2-编写reducer类" class="header-anchor">¶</a> （2）编写Reducer类</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>package com.test.hadoop<span class="token punctuation">;</span>
<span class="token function">import</span> java.io.IOException<span class="token punctuation">;</span>
<span class="token function">import</span> org.apache.hadoop.io.IntWritable<span class="token punctuation">;</span>
<span class="token function">import</span> org.apache.hadoop.io.Text<span class="token punctuation">;</span>
<span class="token function">import</span> org.apache.hadoop.mapreduce.Reducer<span class="token punctuation">;</span>

public class WordcountReducer extends Reducer<span class="token operator">&lt;</span>Text, IntWritable, Text, IntWritable<span class="token operator">&gt;</span><span class="token punctuation">{</span>
    int <span class="token function">sum</span><span class="token punctuation">;</span>
    IntWritable <span class="token function">v</span> <span class="token operator">=</span> new IntWritable<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    @Override
    protected void reduce<span class="token punctuation">(</span>Text key, Iterable<span class="token operator">&lt;</span>IntWritable<span class="token operator">&gt;</span> values,Context context<span class="token punctuation">)</span> throws IOException, InterruptedException <span class="token punctuation">{</span>

        // <span class="token number">1</span> 累加求和
        <span class="token function">sum</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>IntWritable count <span class="token builtin class-name">:</span> values<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">sum</span> <span class="token operator">+=</span> count.get<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        // <span class="token number">2</span> 输出
        v.set<span class="token punctuation">(</span>sum<span class="token punctuation">)</span><span class="token punctuation">;</span>
        context.write<span class="token punctuation">(</span>key,v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h4 id="_3-编写driver驱动类"><a href="#_3-编写driver驱动类" class="header-anchor">¶</a> （3）编写Driver驱动类</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>package com.test.hadoop<span class="token punctuation">;</span>


<span class="token function">import</span> java.io.IOException<span class="token punctuation">;</span>
<span class="token function">import</span> org.apache.hadoop.conf.Configuration<span class="token punctuation">;</span>
<span class="token function">import</span> org.apache.hadoop.fs.Path<span class="token punctuation">;</span>
<span class="token function">import</span> org.apache.hadoop.io.IntWritable<span class="token punctuation">;</span>
<span class="token function">import</span> org.apache.hadoop.io.Text<span class="token punctuation">;</span>
<span class="token function">import</span> org.apache.hadoop.mapreduce.Job<span class="token punctuation">;</span>
<span class="token function">import</span> org.apache.hadoop.mapreduce.lib.input.FileInputFormat<span class="token punctuation">;</span>
<span class="token function">import</span> org.apache.hadoop.mapreduce.lib.output.FileOutputFormat<span class="token punctuation">;</span>

    public class WordcountDriver <span class="token punctuation">{</span>

        public static void main<span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> throws IOException, ClassNotFoundException, InterruptedException <span class="token punctuation">{</span>

            // <span class="token number">1</span> 获取配置信息以及封装任务
            Configuration configuration <span class="token operator">=</span> new Configuration<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            Job job <span class="token operator">=</span> Job.getInstance<span class="token punctuation">(</span>configuration<span class="token punctuation">)</span><span class="token punctuation">;</span>

            // <span class="token number">2</span> 设置jar加载路径
            job.setJarByClass<span class="token punctuation">(</span>WordcountDriver.class<span class="token punctuation">)</span><span class="token punctuation">;</span>

            // <span class="token number">3</span> 设置map和reduce类
            job.setMapperClass<span class="token punctuation">(</span>WordcountMapper.class<span class="token punctuation">)</span><span class="token punctuation">;</span>
            job.setReducerClass<span class="token punctuation">(</span>WordcountReducer.class<span class="token punctuation">)</span><span class="token punctuation">;</span>

            // <span class="token number">4</span> 设置map输出
            job.setMapOutputKeyClass<span class="token punctuation">(</span>Text.class<span class="token punctuation">)</span><span class="token punctuation">;</span>
            job.setMapOutputValueClass<span class="token punctuation">(</span>IntWritable.class<span class="token punctuation">)</span><span class="token punctuation">;</span>

            // <span class="token number">5</span> 设置最终输出kv类型
            job.setOutputKeyClass<span class="token punctuation">(</span>Text.class<span class="token punctuation">)</span><span class="token punctuation">;</span>
            job.setOutputValueClass<span class="token punctuation">(</span>IntWritable.class<span class="token punctuation">)</span><span class="token punctuation">;</span>

            // <span class="token number">6</span> 设置输入和输出路径
            String inpath <span class="token operator">=</span><span class="token string">&quot;hdfs://10.211.55.6:9000/test/hello.txt&quot;</span><span class="token punctuation">;</span>
            String outpath <span class="token operator">=</span><span class="token string">&quot;hdfs://10.211.55.6:9000/output3&quot;</span><span class="token punctuation">;</span>
           
           
                       FileInputFormat.setInputPaths<span class="token punctuation">(</span>job, new Path<span class="token punctuation">(</span>inpath<span class="token punctuation">))</span><span class="token punctuation">;</span>
                       FileOutputFormat.setOutputPath<span class="token punctuation">(</span>job, new Path<span class="token punctuation">(</span>outpath<span class="token punctuation">))</span><span class="token punctuation">;</span>


            // <span class="token number">7</span> 提交
            boolean result <span class="token operator">=</span> job.waitForCompletion<span class="token punctuation">(</span>true<span class="token punctuation">)</span><span class="token punctuation">;</span>

            System.exit<span class="token punctuation">(</span>result ? <span class="token number">0</span> <span class="token builtin class-name">:</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br></div></div><p><img src="/images/hadoop/MapReduce-result.png" alt="result"></p> <h3 id="_5-编写应用程序"><a href="#_5-编写应用程序" class="header-anchor">¶</a> 5.编写应用程序</h3> <p>MapReduce将处理分为两个阶段：map阶段和reduce阶段。</p> <p><img src="/images/hadoop/application.png" alt="application"></p> <h4 id="writing-an-application-mapper"><a href="#writing-an-application-mapper" class="header-anchor">¶</a> Writing an Application – Mapper</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hdfs<span class="token punctuation">.</span>api</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>classification<span class="token punctuation">.</span></span><span class="token class-name">InterfaceAudience</span><span class="token punctuation">.</span><span class="token class-name">Private</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IntWritable</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">LongWritable</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">Text</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>mapreduce<span class="token punctuation">.</span></span><span class="token class-name">Mapper</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>codahale<span class="token punctuation">.</span>metrics<span class="token punctuation">.</span></span><span class="token class-name">Timer</span><span class="token punctuation">.</span><span class="token class-name">Context</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MaxTemperatureMapper</span>
	<span class="token keyword">extends</span> <span class="token class-name">Mapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LongWritable</span><span class="token punctuation">,</span> <span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">IntWritable</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>
	
		
	<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> MISSING <span class="token operator">=</span> <span class="token number">9999</span><span class="token punctuation">;</span>
	
	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">LongWritable</span> key<span class="token punctuation">,</span> <span class="token class-name">Text</span> value<span class="token punctuation">,</span> <span class="token class-name">Context</span> context<span class="token punctuation">)</span>
		<span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">{</span>
		
		<span class="token class-name">String</span> line <span class="token operator">=</span> value<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">String</span> year <span class="token operator">=</span> line<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">int</span> airTemperature<span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>line<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span><span class="token number">87</span><span class="token punctuation">)</span> <span class="token operator">==</span><span class="token string">'+'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			airTemperature <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>line<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">88</span><span class="token punctuation">,</span> <span class="token number">92</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
			airTemperature <span class="token operator">=</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>line<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">87</span><span class="token punctuation">,</span> <span class="token number">92</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token class-name">String</span> quality <span class="token operator">=</span> line<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">92</span><span class="token punctuation">,</span> <span class="token number">93</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>airTemperature <span class="token operator">!=</span> MISSING <span class="token operator">&amp;&amp;</span> quality<span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span><span class="token string">&quot;[01459]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			context<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Text</span><span class="token punctuation">(</span>year<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">IntWritable</span><span class="token punctuation">(</span>airTemperature<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><h4 id="writing-an-application-reducer"><a href="#writing-an-application-reducer" class="header-anchor">¶</a> Writing an Application – Reducer</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hdfs<span class="token punctuation">.</span>api</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IntWritable</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">Text</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>mapreduce<span class="token punctuation">.</span></span><span class="token class-name">Reducer</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MaxTemperatureReducer</span> 
	<span class="token keyword">extends</span> <span class="token class-name">Reducer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">IntWritable</span><span class="token punctuation">,</span> <span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">IntWritable</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
	
	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">reduce</span><span class="token punctuation">(</span><span class="token class-name">Text</span> key<span class="token punctuation">,</span> <span class="token class-name">Iterable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">IntWritable</span><span class="token punctuation">&gt;</span></span> values<span class="token punctuation">,</span> <span class="token class-name">Context</span> context<span class="token punctuation">)</span>
		<span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
		
		<span class="token keyword">int</span> maxValue <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span>MIN_VALUE<span class="token punctuation">;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">IntWritable</span> value <span class="token operator">:</span> values<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			maxValue <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>maxValue<span class="token punctuation">,</span> value<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>  
		context<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">IntWritable</span><span class="token punctuation">(</span>maxValue<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h4 id="writing-an-application-job"><a href="#writing-an-application-job" class="header-anchor">¶</a> Writing an Application – Job</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hdfs<span class="token punctuation">.</span>api</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>fs<span class="token punctuation">.</span></span><span class="token class-name">Path</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IntWritable</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">Text</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>mapreduce<span class="token punctuation">.</span></span><span class="token class-name">Job</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>mapreduce<span class="token punctuation">.</span>lib<span class="token punctuation">.</span>input<span class="token punctuation">.</span></span><span class="token class-name">FileInputFormat</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>mapreduce<span class="token punctuation">.</span>lib<span class="token punctuation">.</span>output<span class="token punctuation">.</span></span><span class="token class-name">FileOutputFormat</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MaxTemperature</span> <span class="token punctuation">{</span>
 <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
<span class="token comment">//	if (args.length !=2) {</span>
<span class="token comment">//		 System.err.println(&quot;Usage: MaxTemperature&lt;input path&gt;&lt;output path&gt;&quot;);</span>
<span class="token comment">//		 System.exit(-1);</span>
<span class="token comment">//		 </span>
<span class="token comment">//	 }</span>
	
	 <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">&quot;HADOOP_USER_NAME&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;hadoop&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	 
	<span class="token class-name">Job</span> job <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Job</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	 job<span class="token punctuation">.</span><span class="token function">setJarByClass</span><span class="token punctuation">(</span><span class="token class-name">MaxTemperature</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	 job<span class="token punctuation">.</span><span class="token function">setJobName</span><span class="token punctuation">(</span><span class="token string">&quot;Max temperature&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	 
	    <span class="token class-name">String</span> inpath <span class="token operator">=</span><span class="token string">&quot;hdfs://10.211.55.6:9000/wordcount/input/test/sample.txt&quot;</span><span class="token punctuation">;</span>
		<span class="token class-name">String</span> outpath <span class="token operator">=</span><span class="token string">&quot;hdfs://10.211.55.6:9000/output&quot;</span><span class="token punctuation">;</span>		
		
	 <span class="token class-name">FileInputFormat</span><span class="token punctuation">.</span><span class="token function">addInputPath</span><span class="token punctuation">(</span>job<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">(</span>inpath<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	 <span class="token class-name">FileOutputFormat</span><span class="token punctuation">.</span><span class="token function">setOutputPath</span><span class="token punctuation">(</span>job<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">(</span>outpath<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	 
	 job<span class="token punctuation">.</span><span class="token function">setMapperClass</span><span class="token punctuation">(</span><span class="token class-name">MaxTemperatureMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	 job<span class="token punctuation">.</span><span class="token function">setReducerClass</span><span class="token punctuation">(</span><span class="token class-name">MaxTemperatureReducer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	 
	 job<span class="token punctuation">.</span><span class="token function">setOutputKeyClass</span><span class="token punctuation">(</span><span class="token class-name">Text</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	 job<span class="token punctuation">.</span><span class="token function">setOutputValueClass</span><span class="token punctuation">(</span><span class="token class-name">IntWritable</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	 
	 <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span>job<span class="token punctuation">.</span><span class="token function">waitForCompletion</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
	  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><h3 id="在群集上运行"><a href="#在群集上运行" class="header-anchor">¶</a> 在群集上运行</h3> <h4 id="打包"><a href="#打包" class="header-anchor">¶</a> 打包</h4> <p>将程序打包为JAR文件以发送到集群，使用Ant方便构建
<img src="/images/hadoop/ant.png" alt="ant"></p> <h4 id="启动job"><a href="#启动job" class="header-anchor">¶</a> 启动job</h4> <p>使用-conf选项运行驱动程序以指定集群
<img src="/images/hadoop/successfully.png" alt="successfully">
输出更多有用的信息
<img src="/images/hadoop/information.png" alt="information"></p> <h3 id="the-mapreduce-web-ui"><a href="#the-mapreduce-web-ui" class="header-anchor">¶</a> The MapReduce Web UI</h3> <p>用于查找作业的进度、统计信息和日志，http://resource-manager-host:8088/
<img src="/images/hadoop/webUI.png" alt="web"></p> <h3 id="检索结果"><a href="#检索结果" class="header-anchor">¶</a> 检索结果</h3> <p>每个reducer产生一个输出文件，e.g. part-00000 … part-00029</p> <p><img src="/images/hadoop/output.png" alt="output"></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/hadoop/io.html" class="prev">
        Hadoop I/O
      </a></span> <span class="next"><a href="/hadoop/mysql.html">
        MySQL
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.7696aff8.js" defer></script><script src="/assets/js/2.3c301967.js" defer></script><script src="/assets/js/19.3f563a7b.js" defer></script>
  </body>
</html>
