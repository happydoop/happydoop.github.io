<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Sqoop | Hadoop</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="Hadoop 学习笔记">
    
    <link rel="preload" href="/assets/css/0.styles.bea26999.css" as="style"><link rel="preload" href="/assets/js/app.7696aff8.js" as="script"><link rel="preload" href="/assets/js/2.3c301967.js" as="script"><link rel="preload" href="/assets/js/25.d294f37a.js" as="script"><link rel="prefetch" href="/assets/js/10.239320ff.js"><link rel="prefetch" href="/assets/js/11.7aea8a94.js"><link rel="prefetch" href="/assets/js/12.a75c9a92.js"><link rel="prefetch" href="/assets/js/13.17c333e6.js"><link rel="prefetch" href="/assets/js/14.c658bd9d.js"><link rel="prefetch" href="/assets/js/15.adf41b6f.js"><link rel="prefetch" href="/assets/js/16.d09250f7.js"><link rel="prefetch" href="/assets/js/17.3a4cbbc8.js"><link rel="prefetch" href="/assets/js/18.a7d27d96.js"><link rel="prefetch" href="/assets/js/19.3f563a7b.js"><link rel="prefetch" href="/assets/js/20.cf7aaa65.js"><link rel="prefetch" href="/assets/js/21.dabe57d5.js"><link rel="prefetch" href="/assets/js/22.8c1d8730.js"><link rel="prefetch" href="/assets/js/23.b9917a11.js"><link rel="prefetch" href="/assets/js/24.095af618.js"><link rel="prefetch" href="/assets/js/26.fc764424.js"><link rel="prefetch" href="/assets/js/27.998a5d50.js"><link rel="prefetch" href="/assets/js/28.7d6e20a5.js"><link rel="prefetch" href="/assets/js/29.d2921661.js"><link rel="prefetch" href="/assets/js/3.566e47d9.js"><link rel="prefetch" href="/assets/js/4.23282b51.js"><link rel="prefetch" href="/assets/js/5.c842d990.js"><link rel="prefetch" href="/assets/js/6.ef414eb3.js"><link rel="prefetch" href="/assets/js/7.3152689a.js"><link rel="prefetch" href="/assets/js/8.530be27e.js"><link rel="prefetch" href="/assets/js/9.a4f965b7.js">
    <link rel="stylesheet" href="/assets/css/0.styles.bea26999.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Hadoop</span></a> <div class="links"><!----> <nav class="nav-links can-hide"><div class="nav-item"><a href="/hadoop/install.html" class="nav-link">
  Hadoop
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/hadoop/install.html" class="nav-link">
  Hadoop
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>基础</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/hadoop/install.html" class="sidebar-link">安装</a></li><li><a href="/hadoop/benchmark.html" class="sidebar-link">集群配置与管理</a></li><li><a href="/hadoop/hdfs.html" class="sidebar-link">HDFS</a></li><li><a href="/hadoop/io.html" class="sidebar-link">Hadoop I/O</a></li><li><a href="/hadoop/mapreduce.html" class="sidebar-link">MapReduce</a></li><li><a href="/hadoop/mysql.html" class="sidebar-link">MySQL</a></li><li><a href="/hadoop/sqoop.html" aria-current="page" class="active sidebar-link">Sqoop</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/hadoop/sqoop.html#简介" class="sidebar-link">简介</a></li><li class="sidebar-sub-header"><a href="/hadoop/sqoop.html#原理" class="sidebar-link">原理</a></li><li class="sidebar-sub-header"><a href="/hadoop/sqoop.html#安装" class="sidebar-link">安装</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/hadoop/sqoop.html#解压和重命名文件" class="sidebar-link">解压和重命名文件</a></li><li class="sidebar-sub-header"><a href="/hadoop/sqoop.html#进入sqoop的配置目录" class="sidebar-link">进入sqoop的配置目录</a></li><li class="sidebar-sub-header"><a href="/hadoop/sqoop.html#编辑-sqoop-env-sh" class="sidebar-link">编辑 sqoop-env.sh</a></li><li class="sidebar-sub-header"><a href="/hadoop/sqoop.html#配置环境变量" class="sidebar-link">配置环境变量</a></li><li class="sidebar-sub-header"><a href="/hadoop/sqoop.html#拷贝-jdbc-驱动" class="sidebar-link">拷贝 JDBC 驱动</a></li><li class="sidebar-sub-header"><a href="/hadoop/sqoop.html#测试连接mysql" class="sidebar-link">测试连接MySQL</a></li></ul></li><li class="sidebar-sub-header"><a href="/hadoop/sqoop.html#sqoop报错" class="sidebar-link">Sqoop报错</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/hadoop/sqoop.html#sqoop连接数据库报错" class="sidebar-link">Sqoop连接数据库报错</a></li></ul></li><li class="sidebar-sub-header"><a href="/hadoop/sqoop.html#sqoop的简单使用案例" class="sidebar-link">Sqoop的简单使用案例</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/hadoop/sqoop.html#导入数据" class="sidebar-link">导入数据</a></li><li class="sidebar-sub-header"><a href="/hadoop/sqoop.html#导出数据" class="sidebar-link">导出数据</a></li></ul></li></ul></li><li><a href="/hadoop/hive.html" class="sidebar-link">Hive</a></li><li><a href="/hadoop/hbase.html" class="sidebar-link">HBase</a></li><li><a href="/hadoop/pig.html" class="sidebar-link">Pig</a></li><li><a href="/hadoop/spark.html" class="sidebar-link">Spark</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="sqoop"><a href="#sqoop" class="header-anchor">¶</a> Sqoop</h1> <h2 id="简介"><a href="#简介" class="header-anchor">¶</a> 简介</h2> <p>Sqoop 是一款开源的工具，主要用于在 Hadoop(Hive) 与传统的数据库 (mysql、postgresql...) 间进行数据的传递，可以将一个关系型数据库（例如 ： MySQL ,Oracle ,Postgres等）中的数据导进到 Hadoop 的 HDFS 中，也可以将 HDFS 的数据导进到关系型数据库中。</p> <p>Sqoop 项目开始于 2009 年，最早是作为 Hadoop 的一个第三方模块存在，后来为了让使用者能够快速部署，也为了让开发人员能够更快速的迭代开发，Sqoop 独立成为一个 Apache 项目。
Sqoop2 的最新版本是 1.99.7。请注意，2 与 1 不兼容，且特征不完整，它并不打算用于生产部署。
最后权衡之后我们选用 sqoop-1.4.7。</p> <h2 id="原理"><a href="#原理" class="header-anchor">¶</a> 原理</h2> <p>将导入或导出命令翻译成 mapreduce 程序来实现，在翻译出的mapreduce中主要是对inputformat和outputformat进行定制。</p> <h2 id="安装"><a href="#安装" class="header-anchor">¶</a> 安装</h2> <p>安装 Sqoop 的前提是已经具备Java和Hadoop的环境。</p> <h3 id="解压和重命名文件"><a href="#解压和重命名文件" class="header-anchor">¶</a> 解压和重命名文件</h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">mkdir</span> /usr/local/sqoop
<span class="token function">tar</span> -zxvf sqoop-1.4.7.bin__hadoop-2.6.0.tar.gz -C /usr/local/sqoop
<span class="token builtin class-name">cd</span> /usr/local/sqoop
<span class="token function">mv</span> sqoop-1.4.7.bin__hadoop-2.6.0  sqoop-1.4.7
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="进入sqoop的配置目录"><a href="#进入sqoop的配置目录" class="header-anchor">¶</a> 进入sqoop的配置目录</h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token builtin class-name">cd</span> /usr/local/sqoop/sqoop-1.4.7/conf/
<span class="token comment"># 将sqoop-env-template.sh复制一份并命名为sqoop-env.sh</span>
<span class="token function">cp</span> sqoop-env-template.sh sqoop-env.sh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="编辑-sqoop-env-sh"><a href="#编辑-sqoop-env-sh" class="header-anchor">¶</a> 编辑 sqoop-env.sh</h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">vim</span> sqoop-env.sh

<span class="token comment">#Set path to where bin/hadoop is available</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">HADOOP_COMMON_HOME</span><span class="token operator">=</span>/usr/local/hadoop/hadoop-3.2.0
<span class="token comment">#Set path to where hadoop-*-core.jar is available</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">HADOOP_MAPRED_HOME</span><span class="token operator">=</span>/usr/local/hadoop/hadoop-3.2.0
<span class="token comment">#set the path to where bin/hbase is available</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">HBASE_HOME</span><span class="token operator">=</span>/usr/local/hadoop/hbase_2.2.6
<span class="token comment">#Set the path to where bin/hive is available</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">HIVE_HOME</span><span class="token operator">=</span>/usr/local/hive/hive-2.3.7
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="配置环境变量"><a href="#配置环境变量" class="header-anchor">¶</a> 配置环境变量</h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># vim /etc/profile</span>
 
<span class="token comment"># sqoop config</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">SQOOP_HOME</span><span class="token operator">=</span>/usr/local/sqoop/sqoop-1.4.7
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span><span class="token builtin class-name">:</span><span class="token variable">$SQOOP_HOME</span>/bin

<span class="token comment"># 刷新配置文件</span>
<span class="token comment"># source /etc/profile</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="拷贝-jdbc-驱动"><a href="#拷贝-jdbc-驱动" class="header-anchor">¶</a> 拷贝 JDBC 驱动</h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 拷贝mysql-connector-java-8.0.16.tar.gz 到lib目录下</span>
<span class="token function">cp</span> mysql-connector-java-8.0.16.tar.gz /usr/local/sqoop/sqoop-1.4.7/lib

<span class="token comment"># 验证sqoop</span>
bin/sqoop <span class="token builtin class-name">help</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><img src="/images/hadoop/sqoop-bin-help.png" alt="sqoop help 命令"></p> <h3 id="测试连接mysql"><a href="#测试连接mysql" class="header-anchor">¶</a> 测试连接MySQL</h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>bin/sqoop list-databases --connect jdbc:mysql://10.211.55.7:3306/ --username root --password root 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/images/hadoop/sqoop-connect-mysql.png" alt="连接 mysql"></p> <h2 id="sqoop报错"><a href="#sqoop报错" class="header-anchor">¶</a> Sqoop报错</h2> <h3 id="sqoop连接数据库报错"><a href="#sqoop连接数据库报错" class="header-anchor">¶</a> Sqoop连接数据库报错</h3> <p>找不到 <code>org/apache/commons/lang/StringUtils</code></p> <p>解决方法：</p> <p>在 apache 上下载 commons-lang-2.6.jar 包并上传到 lib 下即可，下载地址：
<a href="http://mirrors.tuna.tsinghua.edu.cn/apache//commons/lang/binaries/commons-lang-2.6-bin.zip" target="_blank" rel="noopener noreferrer">commons-lang-2.6<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="sqoop的简单使用案例"><a href="#sqoop的简单使用案例" class="header-anchor">¶</a> Sqoop的简单使用案例</h2> <h3 id="导入数据"><a href="#导入数据" class="header-anchor">¶</a> 导入数据</h3> <p>在Sqoop中，“导入”概念指：从非大数据集群（RDBMS）向大数据集群（HDFS，HIVE，HBASE）中传输数据，叫做：导入，即使用import关键字。</p> <h4 id="rdbms到hdfs"><a href="#rdbms到hdfs" class="header-anchor">¶</a> RDBMS到HDFS</h4> <p>(1) 确定Mysql服务开启正常</p> <p>(2) 在Mysql中新建一张表并插入一些数据</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>$ mysql -uroot -p
Enter password:root
mysql<span class="token operator">&gt;</span> create database company<span class="token punctuation">;</span>
mysql<span class="token operator">&gt;</span> create table company.staff<span class="token punctuation">(</span>id int<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> primary key not null auto_increment, name varchar<span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span>, sex varchar<span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
mysql<span class="token operator">&gt;</span> insert into company.staff<span class="token punctuation">(</span>name, sex<span class="token punctuation">)</span> values<span class="token punctuation">(</span><span class="token string">'Thomas'</span>, <span class="token string">'Male'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
mysql<span class="token operator">&gt;</span> insert into company.staff<span class="token punctuation">(</span>name, sex<span class="token punctuation">)</span> values<span class="token punctuation">(</span><span class="token string">'Catalina'</span>, <span class="token string">'FeMale'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><img src="/images/hadoop/sqoop-select-from-staff.png" alt="select * from staff"></p> <p>(3) 导入数据</p> <p>全部导入</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>$ bin/sqoop <span class="token function">import</span> <span class="token punctuation">\</span>
--connect jdbc:mysql://10.211.55.7:3306/company <span class="token punctuation">\</span>
--username root <span class="token punctuation">\</span>
--password root <span class="token punctuation">\</span>
--table staff <span class="token punctuation">\</span>
--target-dir /user/company <span class="token punctuation">\</span>
--delete-target-dir <span class="token punctuation">\</span>
--num-mappers <span class="token number">1</span> <span class="token punctuation">\</span>
--fields-terminated-by <span class="token string">&quot;<span class="token entity" title="\t">\t</span>&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>在浏览器打开 http://10.211.55.6:50070/explorer.html#/user/company</p> <p>可以看到结果part-m-00000</p> <p><img src="/images/hadoop/sqoop-import.png" alt="sqoop import"></p> <h4 id="rdbms到hive"><a href="#rdbms到hive" class="header-anchor">¶</a> RDBMS到Hive</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>$ bin/sqoop <span class="token function">import</span> <span class="token punctuation">\</span>
--connect jdbc:mysql://10.211.55.7:3306/company <span class="token punctuation">\</span>
--username root <span class="token punctuation">\</span>
--password root <span class="token punctuation">\</span>
--table staff <span class="token punctuation">\</span>
--num-mappers <span class="token number">1</span> <span class="token punctuation">\</span>
--hive-import <span class="token punctuation">\</span>
--fields-terminated-by <span class="token string">&quot;<span class="token entity" title="\t">\t</span>&quot;</span> <span class="token punctuation">\</span>
--hive-overwrite <span class="token punctuation">\</span>
--hive-table staff_hive
<span class="token comment"># 提示：该过程分为两步，第一步将数据导入到HDFS，第二步将导入到HDFS的数据迁移到Hive仓库</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>打开浏览器 http://10.211.55.6:50070/explorer.html#/usr/hive/hive-2.3.7/warehouse/staff_hive</p> <p>可以看到结果part-m-00000</p> <p><img src="/images/hadoop/sqoop-import-hive.png" alt="sqoop import hive"></p> <h3 id="导出数据"><a href="#导出数据" class="header-anchor">¶</a> 导出数据</h3> <p>在Sqoop中，“导出”概念指：从大数据集群（HDFS，HIVE，HBASE）向非大数据集群（RDBMS）中传输数据，叫做：导出，即使用export关键字。</p> <h4 id="hive-hdfs到rdbms"><a href="#hive-hdfs到rdbms" class="header-anchor">¶</a> HIVE/HDFS到RDBMS</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>//先在mysql清空表数据
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> * from staff<span class="token punctuation">;</span>
mysql<span class="token operator">&gt;</span> truncate table staff<span class="token punctuation">;</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> * from staff<span class="token punctuation">;</span>
Empty <span class="token builtin class-name">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span> 

$ bin/sqoop <span class="token builtin class-name">export</span> <span class="token punctuation">\</span>
--connect jdbc:mysql://10.211.55.7:3306/company <span class="token punctuation">\</span>
--username root <span class="token punctuation">\</span>
--password root <span class="token punctuation">\</span>
--table staff <span class="token punctuation">\</span>
--num-mappers <span class="token number">1</span> <span class="token punctuation">\</span>
--export-dir /usr/hive/hive-2.3.7/warehouse/staff_hive <span class="token punctuation">\</span>
--input-fields-terminated-by <span class="token string">&quot;<span class="token entity" title="\t">\t</span>&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>运行结束</p> <p><img src="/images/hadoop/sqoop-export.png" alt="sqoop export"></p> <p><img src="/images/hadoop/sqoop-export-mysql.png" alt="sqoop export"></p> <p>完成</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/hadoop/mysql.html" class="prev">
        MySQL
      </a></span> <span class="next"><a href="/hadoop/hive.html">
        Hive
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.7696aff8.js" defer></script><script src="/assets/js/2.3c301967.js" defer></script><script src="/assets/js/25.d294f37a.js" defer></script>
  </body>
</html>
