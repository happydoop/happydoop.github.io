<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Hive | Hadoop</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="Hadoop 学习笔记">
    
    <link rel="preload" href="/assets/css/0.styles.bea26999.css" as="style"><link rel="preload" href="/assets/js/app.7696aff8.js" as="script"><link rel="preload" href="/assets/js/2.3c301967.js" as="script"><link rel="preload" href="/assets/js/16.d09250f7.js" as="script"><link rel="preload" href="/assets/js/11.7aea8a94.js" as="script"><link rel="prefetch" href="/assets/js/10.239320ff.js"><link rel="prefetch" href="/assets/js/12.a75c9a92.js"><link rel="prefetch" href="/assets/js/13.17c333e6.js"><link rel="prefetch" href="/assets/js/14.c658bd9d.js"><link rel="prefetch" href="/assets/js/15.adf41b6f.js"><link rel="prefetch" href="/assets/js/17.3a4cbbc8.js"><link rel="prefetch" href="/assets/js/18.a7d27d96.js"><link rel="prefetch" href="/assets/js/19.3f563a7b.js"><link rel="prefetch" href="/assets/js/20.cf7aaa65.js"><link rel="prefetch" href="/assets/js/21.dabe57d5.js"><link rel="prefetch" href="/assets/js/22.8c1d8730.js"><link rel="prefetch" href="/assets/js/23.b9917a11.js"><link rel="prefetch" href="/assets/js/24.095af618.js"><link rel="prefetch" href="/assets/js/25.d294f37a.js"><link rel="prefetch" href="/assets/js/26.fc764424.js"><link rel="prefetch" href="/assets/js/27.998a5d50.js"><link rel="prefetch" href="/assets/js/28.7d6e20a5.js"><link rel="prefetch" href="/assets/js/29.d2921661.js"><link rel="prefetch" href="/assets/js/3.566e47d9.js"><link rel="prefetch" href="/assets/js/4.23282b51.js"><link rel="prefetch" href="/assets/js/5.c842d990.js"><link rel="prefetch" href="/assets/js/6.ef414eb3.js"><link rel="prefetch" href="/assets/js/7.3152689a.js"><link rel="prefetch" href="/assets/js/8.530be27e.js"><link rel="prefetch" href="/assets/js/9.a4f965b7.js">
    <link rel="stylesheet" href="/assets/css/0.styles.bea26999.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Hadoop</span></a> <div class="links"><!----> <nav class="nav-links can-hide"><div class="nav-item"><a href="/hadoop/install.html" class="nav-link">
  Hadoop
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/hadoop/install.html" class="nav-link">
  Hadoop
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>基础</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/hadoop/install.html" class="sidebar-link">安装</a></li><li><a href="/hadoop/benchmark.html" class="sidebar-link">集群配置与管理</a></li><li><a href="/hadoop/hdfs.html" class="sidebar-link">HDFS</a></li><li><a href="/hadoop/io.html" class="sidebar-link">Hadoop I/O</a></li><li><a href="/hadoop/mapreduce.html" class="sidebar-link">MapReduce</a></li><li><a href="/hadoop/mysql.html" class="sidebar-link">MySQL</a></li><li><a href="/hadoop/sqoop.html" class="sidebar-link">Sqoop</a></li><li><a href="/hadoop/hive.html" aria-current="page" class="active sidebar-link">Hive</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/hadoop/hive.html#介绍" class="sidebar-link">介绍</a></li><li class="sidebar-sub-header"><a href="/hadoop/hive.html#安装" class="sidebar-link">安装</a></li><li class="sidebar-sub-header"><a href="/hadoop/hive.html#与关系型数据库的比较" class="sidebar-link">与关系型数据库的比较</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/hadoop/hive.html#查询语言" class="sidebar-link">查询语言</a></li><li class="sidebar-sub-header"><a href="/hadoop/hive.html#数据存储位置" class="sidebar-link">数据存储位置</a></li><li class="sidebar-sub-header"><a href="/hadoop/hive.html#数据更新" class="sidebar-link">数据更新</a></li><li class="sidebar-sub-header"><a href="/hadoop/hive.html#索引" class="sidebar-link">索引</a></li><li class="sidebar-sub-header"><a href="/hadoop/hive.html#执行" class="sidebar-link">执行</a></li><li class="sidebar-sub-header"><a href="/hadoop/hive.html#执行延迟" class="sidebar-link">执行延迟</a></li><li class="sidebar-sub-header"><a href="/hadoop/hive.html#可扩展性" class="sidebar-link">可扩展性</a></li><li class="sidebar-sub-header"><a href="/hadoop/hive.html#数据规模" class="sidebar-link">数据规模</a></li></ul></li><li class="sidebar-sub-header"><a href="/hadoop/hive.html#hive基本操作" class="sidebar-link">Hive基本操作</a></li><li class="sidebar-sub-header"><a href="/hadoop/hive.html#hiveql" class="sidebar-link">HiveQL</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/hadoop/hive.html#表与查询" class="sidebar-link">表与查询</a></li></ul></li></ul></li><li><a href="/hadoop/hbase.html" class="sidebar-link">HBase</a></li><li><a href="/hadoop/pig.html" class="sidebar-link">Pig</a></li><li><a href="/hadoop/spark.html" class="sidebar-link">Spark</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="hive"><a href="#hive" class="header-anchor">¶</a> Hive</h1> <p>本文以hive-2.3.7为例进行讲解。</p> <h2 id="介绍"><a href="#介绍" class="header-anchor">¶</a> 介绍</h2> <p>Hive：由Facebook开源用于解决海量结构化日志的数据统计。</p> <p>Hive是基于Hadoop的一个数据仓库工具，可以将结构化的数据文件映射为一张表，并提供类 SQL 查询功能。</p> <p>本质是：将HQL转化成 MapReduce 程序</p> <p>1）Hive处理的数据存储在HDFS；</p> <p>2）Hive分析数据底层的默认实现是MapReduce；</p> <p>3）执行程序运行在Yarn上。</p> <h2 id="安装"><a href="#安装" class="header-anchor">¶</a> 安装</h2> <p>首先下载所需的安装包，下载地址为：http://archive.apache.org/dist/hive/，注意这里下载的安装包是apache-hive-2.3.7-bin.tar.gz。</p> <p>解压：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>tar -zxvf apache-hive-2.3.7-bin.tar.gz
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>之后将其移到/home/hadoop/apps目录下：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>mv apache-hive-2.3.7-bin /home/hadoop/apps
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>然后使用 root 权限配置环境变量，vim /etc/profile：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>export HIVE_HOME=/home/hadoop/apps/apache-hive-2.3.7-bin
export PATH=$PATH:$HIVE_HOME/bin
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>注意：一定要使配置的环境变量生效！！！</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>source /etc/profile
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>再修改hive相关的配置文件，首先进入conf文件夹：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>cd /home/hadoop/apps/apache-hive-2.3.7-bin/conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>之后再对hive-site.xml文件进行修改，将以下内容加入该文件中：</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span> 
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>javax.jdo.option.ConnectionURL<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>jdbc:mysql://10.211.55.100:3306/hive_metastore?createDatabaseIfNotExist=true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span> 
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>javax.jdo.option.ConnectionDriverName<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>com.mysql.cj.jdbc.Driver<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span> 
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>javax.jdo.option.ConnectionUserName<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>root<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span> 
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>javax.jdo.option.ConnectionPassword<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>root<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span> 
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>hive.metastore.local<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span> 
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>hive.metastore.local<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>thrift://localhost:9083<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span> 
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>hive.metastore.warehouse.dir<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>/home/hadoop/apps/apache-hive-2.3.7-bin/warehouse<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p>接着将mysql-connector-java-8.0.16.jar文件放入到lib文件夹中，jar包可从MySQL官网下载。</p> <img src="/images/hadoop/mysql-connector-java-8.0.16.jar.png" width="90%" height="auto" loading="lazy" alt="mysql-connector-java" style="display:block;margin:2.2rem auto;max-width:100%;" data-v-2d939f46> <p>最后启动hive：</p> <p>在开启hive前要启动集群，在资源配置的虚拟机上使用start-all.sh指令，启动后如图所示：</p> <img src="/images/hadoop/start-all.png" width="90%" height="auto" loading="lazy" alt="start-all" style="display:block;margin:2.2rem auto;max-width:100%;" data-v-2d939f46> <p>之后再使用hive指令启动hive：</p> <img src="/images/hadoop/hive-client.png" width="90%" height="auto" loading="lazy" alt="hive-client" style="display:block;margin:2.2rem auto;max-width:100%;" data-v-2d939f46> <h2 id="与关系型数据库的比较"><a href="#与关系型数据库的比较" class="header-anchor">¶</a> 与关系型数据库的比较</h2> <p>由于Hive 采用了类似 SQL 的查询语言 HQL(Hive Query Language)，因此很容易将 Hive 理解为数据库。其实从结构上来看，Hive 和数据库除了拥有类似的查询语言，再无类似之处。本节将从多个方面来阐述 Hive 和数据库的差异。数据库可以用在 Online 的应用中，但是 Hive 是为数据仓库而设计的，清楚这一点，有助于从应用角度理解 Hive 的特性。</p> <h3 id="查询语言"><a href="#查询语言" class="header-anchor">¶</a> 查询语言</h3> <p>由于 SQL 被广泛的应用在数据仓库中，因此，专门针对 Hive 的特性设计了类 SQL的查询语言 HQL。熟悉 SQL 开发的开发者可以很方便的使用 Hive 进行开发。</p> <h3 id="数据存储位置"><a href="#数据存储位置" class="header-anchor">¶</a> 数据存储位置</h3> <p>Hive 是建立在 Hadoop 之上的，所有 Hive 的数据都是存储在 HDFS 中的。而数据库则可以将数据保存在块设备或者本地文件系统中。</p> <h3 id="数据更新"><a href="#数据更新" class="header-anchor">¶</a> 数据更新</h3> <p>由于 Hive 是针对数据仓库应用设计的，而数据仓库的内容是读多写少的。因此，Hive中不建议对数据的改写，所有的数据都是在加载的时候确定好的。而数据库中的数据通常是需要经常进行修改的，因此可以使用 <code>INSERT INTO … VALUES</code> 添加数据，使用 <code>UPDATE … SET</code> 修改数据。</p> <h3 id="索引"><a href="#索引" class="header-anchor">¶</a> 索引</h3> <p>Hive 在加载数据的过程中不会对数据进行任何处理，甚至不会对数据进行扫描，因此也没有对数据中的某些 Key 建立索引。Hive 要访问数据中满足条件的特定值时，需要暴力扫描整个数据，因此访问延迟较高。由于 MapReduce 的引入， Hive 可以并行访问数据，因此即使没有索引，对于大数据量的访问，Hive 仍然可以体现出优势。数据库中，通常会针对一个或者几个列建立索引，因此对于少量的特定条件的数据的访问，数据库可以有很高的效率，较低的延迟。由于数据的访问延迟较高，决定了 Hive 不适合在线数据查询。</p> <h3 id="执行"><a href="#执行" class="header-anchor">¶</a> 执行</h3> <p>Hive 中大多数查询的执行是通过 Hadoop 提供的 MapReduce 来实现的。而数据库通常 有自己的执行引擎。</p> <h3 id="执行延迟"><a href="#执行延迟" class="header-anchor">¶</a> 执行延迟</h3> <p>Hive 在查询数据的时候，由于没有索引，需要扫描整个表，因此延迟较高。另外一个 导致 Hive 执行延迟高的因素是分布式MapReduce 框架。由于 MapReduce 本身具有较高的延迟， 因此在利用 MapReduce 执行 Hive 查询时，也会有较高的延迟。相对的，数据库的执行延迟较低。当然，这个低是有条件的，即数据规模较小，当数据规模大到超过数据库的处理能力 的时候，Hive 的并行计算显然能体现出优势。</p> <h3 id="可扩展性"><a href="#可扩展性" class="header-anchor">¶</a> 可扩展性</h3> <p>由于 Hive 是建立在 Hadoop 之上的，因此 Hive 的可扩展性是和 Hadoop 的可扩展性是 一致的（世界上最大的 Hadoop 集群在 Yahoo!，2009 年的规模在 4000 台节点左右）。而数据库由于 ACID 语义的严格限制，扩展行非常有限。目前最先进的并行数据库 Oracle 在理论上的扩展能力也只有 100 台左右。</p> <h3 id="数据规模"><a href="#数据规模" class="header-anchor">¶</a> 数据规模</h3> <p>由于 Hive 建立在集群上并可以利用 MapReduce 进行并行计算，因此可以支持很大规模的数据；对应的，数据库可以支持的数据规模较小。</p> <h2 id="hive基本操作"><a href="#hive基本操作" class="header-anchor">¶</a> Hive基本操作</h2> <p>（1）查看数据库</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>hive&gt; show databases;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>（2）打开默认数据库</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>hive&gt; use default;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>（3）显示 default 数据库中的表</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>hive&gt; show tables;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>（4）创建一张表</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>hive&gt; create table student(id int, name string);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>（5）显示数据库中有几张表</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>hive&gt; show tables; 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>（6）查看表的结构</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>hive&gt; desc student;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>（7）向表中插入数据</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>hive&gt; insert into student values(1000,&quot;ss&quot;);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>（8）查询表中数据</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>hive&gt; select * from student;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>（9）删除表</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>hive&gt; drop table student;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>（10）退出 hive</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>hive&gt; quit;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="hiveql"><a href="#hiveql" class="header-anchor">¶</a> HiveQL</h2> <h3 id="表与查询"><a href="#表与查询" class="header-anchor">¶</a> 表与查询</h3> <h4 id="_1-hive-ql-join"><a href="#_1-hive-ql-join" class="header-anchor">¶</a> 1.	HIVE QL -Join</h4> <img src="/images/hadoop/hive-join.png" width="80%" height="auto" loading="lazy" alt="hive-join" style="display:block;margin:2.2rem auto;max-width:100%;" data-v-2d939f46> <p>首先建立一个新的数据库hiveql_join:</p> <img src="/images/hadoop/hivesql-join.png" width="50%" height="auto" loading="lazy" alt="hivesql-join" style="display:block;margin:2.2rem auto;max-width:100%;" data-v-2d939f46> <p>然后检查新的数据库是否创建成功：</p> <img src="/images/hadoop/show-database.png" width="50%" height="auto" loading="lazy" alt="show-database" style="display:block;margin:2.2rem auto;max-width:100%;" data-v-2d939f46> <p>选择所需应用的数据库，并在此数据库中完成相应的操作：</p> <img src="/images/hadoop/use-database.png" width="50%" height="auto" loading="lazy" alt="use-database" style="display:block;margin:2.2rem auto;max-width:100%;" data-v-2d939f46> <p>首先根据表的内容创立两张表page_view和users，并查看表的结构：</p> <img src="/images/hadoop/desc-table.png" width="80%" height="auto" loading="lazy" alt="desc-table" style="display:block;margin:2.2rem auto;max-width:100%;" data-v-2d939f46> <p>接着向表中插入数据：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>insert into page_view values(1,111,&quot;9:08:01&quot;);
insert into page_view values(2,111,&quot;9:08:13&quot;);
insert into page_view values(1,222,&quot;9:08:14&quot;);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>结果如下图所示：</p> <img src="/images/hadoop/select-all.png" width="80%" height="auto" loading="lazy" alt="select-all" style="display:block;margin:2.2rem auto;max-width:100%;" data-v-2d939f46> <p>重复上述步骤创建users表，结果如下图所示：</p> <img src="/images/hadoop/select-all2.png" width="80%" height="auto" loading="lazy" alt="select-all" style="display:block;margin:2.2rem auto;max-width:100%;" data-v-2d939f46> <p>我们需要用这两个表得出pv_users表的结果，首先需要创建出pv_users表的属性：</p> <img src="/images/hadoop/desc-pv_users.png" width="80%" height="auto" loading="lazy" alt="select-all" style="display:block;margin:2.2rem auto;max-width:100%;" data-v-2d939f46> <p>输入以下指令得出pv_users结果：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>hive&gt;insert into table pv_users
    &gt;select pv.pageid,u.age
    &gt;from page_view pv join users u on ((pv.userid = u.userid);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>查看pv_users表：</p> <img src="/images/hadoop/select-all3.png" width="80%" height="auto" loading="lazy" alt="select-all" style="display:block;margin:2.2rem auto;max-width:100%;" data-v-2d939f46> <h4 id="_2-hive-ql-group-by"><a href="#_2-hive-ql-group-by" class="header-anchor">¶</a> 2.	HIVE QL -Group By</h4> <img src="/images/hadoop/hive-group-by.png" width="80%" height="auto" loading="lazy" alt="hive-group-by" style="display:block;margin:2.2rem auto;max-width:100%;" data-v-2d939f46> <p>首先建立新的数据库hiveql_groupby，并检查是否存在：</p> <img src="/images/hadoop/group-by2.png" width="70%" height="auto" loading="lazy" alt="hive-group-by" style="display:block;margin:2.2rem auto;max-width:100%;" data-v-2d939f46> <p>接着再创建表pv_users，操作步骤参考上面HIVE QL -Join内容，结果如下图所示:</p> <img src="/images/hadoop/group-by3.png" width="70%" height="auto" loading="lazy" alt="hive-group-by" style="display:block;margin:2.2rem auto;max-width:100%;" data-v-2d939f46> <p>再创建新表pageid_age_sum表，并查看表的结构：</p> <img src="/images/hadoop/group-by4.png" width="70%" height="auto" loading="lazy" alt="hive-group-by" style="display:block;margin:2.2rem auto;max-width:100%;" data-v-2d939f46> <p>输入以下指令得出pageid_age_sum的结果：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>hive&gt;insert into table pageid_age_sum
    &gt;select pageid,age,count(1)
    &gt;from pv_users
    &gt;group by pageid,age;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>查看pageid_age_sum表：</p> <img src="/images/hadoop/group-by5.png" width="70%" height="auto" loading="lazy" alt="hive-group-by" style="display:block;margin:2.2rem auto;max-width:100%;" data-v-2d939f46></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/hadoop/sqoop.html" class="prev">
        Sqoop
      </a></span> <span class="next"><a href="/hadoop/hbase.html">
        HBase
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.7696aff8.js" defer></script><script src="/assets/js/2.3c301967.js" defer></script><script src="/assets/js/16.d09250f7.js" defer></script><script src="/assets/js/11.7aea8a94.js" defer></script>
  </body>
</html>
